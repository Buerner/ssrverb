#include <iostream>
#include <math.h>
#include "tools.h"

SSRverb::Matrix SSRverb::hadamard(unsigned order, float gain)
{
    // create basic hadamard matrix
    Matrix hadamatrix(2, 2);
    hadamatrix.resize(order, order);
    
    
    hadamatrix[0][0] = 1. * gain;
    hadamatrix[0][1] = 1. * gain;
    hadamatrix[1][0] = 1. * gain;
    hadamatrix[1][1] = -1. * gain;
    
    if ( order == 24 ) {
        hadamatrix[0][0] = 1.f * gain;
        hadamatrix[0][1] = 1.f * gain;
        hadamatrix[0][2] = 1.f * gain;
        hadamatrix[0][3] = 1.f * gain;
        hadamatrix[0][4] = 1.f * gain;
        hadamatrix[0][5] = 1.f * gain;
        hadamatrix[0][6] = 1.f * gain;
        hadamatrix[0][7] = 1.f * gain;
        hadamatrix[0][8] = 1.f * gain;
        hadamatrix[0][9] = 1.f * gain;
        hadamatrix[0][10] = 1.f * gain;
        hadamatrix[0][11] = 1.f * gain;
        hadamatrix[0][12] = 1.f * gain;
        hadamatrix[0][13] = 1.f * gain;
        hadamatrix[0][14] = 1.f * gain;
        hadamatrix[0][15] = 1.f * gain;
        hadamatrix[0][16] = 1.f * gain;
        hadamatrix[0][17] = 1.f * gain;
        hadamatrix[0][18] = 1.f * gain;
        hadamatrix[0][19] = 1.f * gain;
        hadamatrix[0][20] = 1.f * gain;
        hadamatrix[0][21] = 1.f * gain;
        hadamatrix[0][22] = 1.f * gain;
        hadamatrix[0][23] = 1.f * gain;
        hadamatrix[1][0] = 1.f * gain;
        hadamatrix[1][1] = -1.f * gain;
        hadamatrix[1][2] = 1.f * gain;
        hadamatrix[1][3] = -1.f * gain;
        hadamatrix[1][4] = 1.f * gain;
        hadamatrix[1][5] = 1.f * gain;
        hadamatrix[1][6] = 1.f * gain;
        hadamatrix[1][7] = -1.f * gain;
        hadamatrix[1][8] = -1.f * gain;
        hadamatrix[1][9] = -1.f * gain;
        hadamatrix[1][10] = 1.f * gain;
        hadamatrix[1][11] = -1.f * gain;
        hadamatrix[1][12] = 1.f * gain;
        hadamatrix[1][13] = -1.f * gain;
        hadamatrix[1][14] = 1.f * gain;
        hadamatrix[1][15] = -1.f * gain;
        hadamatrix[1][16] = 1.f * gain;
        hadamatrix[1][17] = 1.f * gain;
        hadamatrix[1][18] = 1.f * gain;
        hadamatrix[1][19] = -1.f * gain;
        hadamatrix[1][20] = -1.f * gain;
        hadamatrix[1][21] = -1.f * gain;
        hadamatrix[1][22] = 1.f * gain;
        hadamatrix[1][23] = -1.f * gain;
        hadamatrix[2][0] = 1.f * gain;
        hadamatrix[2][1] = -1.f * gain;
        hadamatrix[2][2] = -1.f * gain;
        hadamatrix[2][3] = 1.f * gain;
        hadamatrix[2][4] = -1.f * gain;
        hadamatrix[2][5] = 1.f * gain;
        hadamatrix[2][6] = 1.f * gain;
        hadamatrix[2][7] = 1.f * gain;
        hadamatrix[2][8] = -1.f * gain;
        hadamatrix[2][9] = -1.f * gain;
        hadamatrix[2][10] = -1.f * gain;
        hadamatrix[2][11] = 1.f * gain;
        hadamatrix[2][12] = 1.f * gain;
        hadamatrix[2][13] = -1.f * gain;
        hadamatrix[2][14] = -1.f * gain;
        hadamatrix[2][15] = 1.f * gain;
        hadamatrix[2][16] = -1.f * gain;
        hadamatrix[2][17] = 1.f * gain;
        hadamatrix[2][18] = 1.f * gain;
        hadamatrix[2][19] = 1.f * gain;
        hadamatrix[2][20] = -1.f * gain;
        hadamatrix[2][21] = -1.f * gain;
        hadamatrix[2][22] = -1.f * gain;
        hadamatrix[2][23] = 1.f * gain;
        hadamatrix[3][0] = 1.f * gain;
        hadamatrix[3][1] = 1.f * gain;
        hadamatrix[3][2] = -1.f * gain;
        hadamatrix[3][3] = -1.f * gain;
        hadamatrix[3][4] = 1.f * gain;
        hadamatrix[3][5] = -1.f * gain;
        hadamatrix[3][6] = 1.f * gain;
        hadamatrix[3][7] = 1.f * gain;
        hadamatrix[3][8] = 1.f * gain;
        hadamatrix[3][9] = -1.f * gain;
        hadamatrix[3][10] = -1.f * gain;
        hadamatrix[3][11] = -1.f * gain;
        hadamatrix[3][12] = 1.f * gain;
        hadamatrix[3][13] = 1.f * gain;
        hadamatrix[3][14] = -1.f * gain;
        hadamatrix[3][15] = -1.f * gain;
        hadamatrix[3][16] = 1.f * gain;
        hadamatrix[3][17] = -1.f * gain;
        hadamatrix[3][18] = 1.f * gain;
        hadamatrix[3][19] = 1.f * gain;
        hadamatrix[3][20] = 1.f * gain;
        hadamatrix[3][21] = -1.f * gain;
        hadamatrix[3][22] = -1.f * gain;
        hadamatrix[3][23] = -1.f * gain;
        hadamatrix[4][0] = 1.f * gain;
        hadamatrix[4][1] = -1.f * gain;
        hadamatrix[4][2] = 1.f * gain;
        hadamatrix[4][3] = -1.f * gain;
        hadamatrix[4][4] = -1.f * gain;
        hadamatrix[4][5] = 1.f * gain;
        hadamatrix[4][6] = -1.f * gain;
        hadamatrix[4][7] = 1.f * gain;
        hadamatrix[4][8] = 1.f * gain;
        hadamatrix[4][9] = 1.f * gain;
        hadamatrix[4][10] = -1.f * gain;
        hadamatrix[4][11] = -1.f * gain;
        hadamatrix[4][12] = 1.f * gain;
        hadamatrix[4][13] = -1.f * gain;
        hadamatrix[4][14] = 1.f * gain;
        hadamatrix[4][15] = -1.f * gain;
        hadamatrix[4][16] = -1.f * gain;
        hadamatrix[4][17] = 1.f * gain;
        hadamatrix[4][18] = -1.f * gain;
        hadamatrix[4][19] = 1.f * gain;
        hadamatrix[4][20] = 1.f * gain;
        hadamatrix[4][21] = 1.f * gain;
        hadamatrix[4][22] = -1.f * gain;
        hadamatrix[4][23] = -1.f * gain;
        hadamatrix[5][0] = 1.f * gain;
        hadamatrix[5][1] = -1.f * gain;
        hadamatrix[5][2] = -1.f * gain;
        hadamatrix[5][3] = 1.f * gain;
        hadamatrix[5][4] = -1.f * gain;
        hadamatrix[5][5] = -1.f * gain;
        hadamatrix[5][6] = 1.f * gain;
        hadamatrix[5][7] = -1.f * gain;
        hadamatrix[5][8] = 1.f * gain;
        hadamatrix[5][9] = 1.f * gain;
        hadamatrix[5][10] = 1.f * gain;
        hadamatrix[5][11] = -1.f * gain;
        hadamatrix[5][12] = 1.f * gain;
        hadamatrix[5][13] = -1.f * gain;
        hadamatrix[5][14] = -1.f * gain;
        hadamatrix[5][15] = 1.f * gain;
        hadamatrix[5][16] = -1.f * gain;
        hadamatrix[5][17] = -1.f * gain;
        hadamatrix[5][18] = 1.f * gain;
        hadamatrix[5][19] = -1.f * gain;
        hadamatrix[5][20] = 1.f * gain;
        hadamatrix[5][21] = 1.f * gain;
        hadamatrix[5][22] = 1.f * gain;
        hadamatrix[5][23] = -1.f * gain;
        hadamatrix[6][0] = 1.f * gain;
        hadamatrix[6][1] = -1.f * gain;
        hadamatrix[6][2] = -1.f * gain;
        hadamatrix[6][3] = -1.f * gain;
        hadamatrix[6][4] = 1.f * gain;
        hadamatrix[6][5] = -1.f * gain;
        hadamatrix[6][6] = -1.f * gain;
        hadamatrix[6][7] = 1.f * gain;
        hadamatrix[6][8] = -1.f * gain;
        hadamatrix[6][9] = 1.f * gain;
        hadamatrix[6][10] = 1.f * gain;
        hadamatrix[6][11] = 1.f * gain;
        hadamatrix[6][12] = 1.f * gain;
        hadamatrix[6][13] = -1.f * gain;
        hadamatrix[6][14] = -1.f * gain;
        hadamatrix[6][15] = -1.f * gain;
        hadamatrix[6][16] = 1.f * gain;
        hadamatrix[6][17] = -1.f * gain;
        hadamatrix[6][18] = -1.f * gain;
        hadamatrix[6][19] = 1.f * gain;
        hadamatrix[6][20] = -1.f * gain;
        hadamatrix[6][21] = 1.f * gain;
        hadamatrix[6][22] = 1.f * gain;
        hadamatrix[6][23] = 1.f * gain;
        hadamatrix[7][0] = 1.f * gain;
        hadamatrix[7][1] = 1.f * gain;
        hadamatrix[7][2] = -1.f * gain;
        hadamatrix[7][3] = -1.f * gain;
        hadamatrix[7][4] = -1.f * gain;
        hadamatrix[7][5] = 1.f * gain;
        hadamatrix[7][6] = -1.f * gain;
        hadamatrix[7][7] = -1.f * gain;
        hadamatrix[7][8] = 1.f * gain;
        hadamatrix[7][9] = -1.f * gain;
        hadamatrix[7][10] = 1.f * gain;
        hadamatrix[7][11] = 1.f * gain;
        hadamatrix[7][12] = 1.f * gain;
        hadamatrix[7][13] = 1.f * gain;
        hadamatrix[7][14] = -1.f * gain;
        hadamatrix[7][15] = -1.f * gain;
        hadamatrix[7][16] = -1.f * gain;
        hadamatrix[7][17] = 1.f * gain;
        hadamatrix[7][18] = -1.f * gain;
        hadamatrix[7][19] = -1.f * gain;
        hadamatrix[7][20] = 1.f * gain;
        hadamatrix[7][21] = -1.f * gain;
        hadamatrix[7][22] = 1.f * gain;
        hadamatrix[7][23] = 1.f * gain;
        hadamatrix[8][0] = 1.f * gain;
        hadamatrix[8][1] = 1.f * gain;
        hadamatrix[8][2] = 1.f * gain;
        hadamatrix[8][3] = -1.f * gain;
        hadamatrix[8][4] = -1.f * gain;
        hadamatrix[8][5] = -1.f * gain;
        hadamatrix[8][6] = 1.f * gain;
        hadamatrix[8][7] = -1.f * gain;
        hadamatrix[8][8] = -1.f * gain;
        hadamatrix[8][9] = 1.f * gain;
        hadamatrix[8][10] = -1.f * gain;
        hadamatrix[8][11] = 1.f * gain;
        hadamatrix[8][12] = 1.f * gain;
        hadamatrix[8][13] = 1.f * gain;
        hadamatrix[8][14] = 1.f * gain;
        hadamatrix[8][15] = -1.f * gain;
        hadamatrix[8][16] = -1.f * gain;
        hadamatrix[8][17] = -1.f * gain;
        hadamatrix[8][18] = 1.f * gain;
        hadamatrix[8][19] = -1.f * gain;
        hadamatrix[8][20] = -1.f * gain;
        hadamatrix[8][21] = 1.f * gain;
        hadamatrix[8][22] = -1.f * gain;
        hadamatrix[8][23] = 1.f * gain;
        hadamatrix[9][0] = 1.f * gain;
        hadamatrix[9][1] = 1.f * gain;
        hadamatrix[9][2] = 1.f * gain;
        hadamatrix[9][3] = 1.f * gain;
        hadamatrix[9][4] = -1.f * gain;
        hadamatrix[9][5] = -1.f * gain;
        hadamatrix[9][6] = -1.f * gain;
        hadamatrix[9][7] = 1.f * gain;
        hadamatrix[9][8] = -1.f * gain;
        hadamatrix[9][9] = -1.f * gain;
        hadamatrix[9][10] = 1.f * gain;
        hadamatrix[9][11] = -1.f * gain;
        hadamatrix[9][12] = 1.f * gain;
        hadamatrix[9][13] = 1.f * gain;
        hadamatrix[9][14] = 1.f * gain;
        hadamatrix[9][15] = 1.f * gain;
        hadamatrix[9][16] = -1.f * gain;
        hadamatrix[9][17] = -1.f * gain;
        hadamatrix[9][18] = -1.f * gain;
        hadamatrix[9][19] = 1.f * gain;
        hadamatrix[9][20] = -1.f * gain;
        hadamatrix[9][21] = -1.f * gain;
        hadamatrix[9][22] = 1.f * gain;
        hadamatrix[9][23] = -1.f * gain;
        hadamatrix[10][0] = 1.f * gain;
        hadamatrix[10][1] = -1.f * gain;
        hadamatrix[10][2] = 1.f * gain;
        hadamatrix[10][3] = 1.f * gain;
        hadamatrix[10][4] = 1.f * gain;
        hadamatrix[10][5] = -1.f * gain;
        hadamatrix[10][6] = -1.f * gain;
        hadamatrix[10][7] = -1.f * gain;
        hadamatrix[10][8] = 1.f * gain;
        hadamatrix[10][9] = -1.f * gain;
        hadamatrix[10][10] = -1.f * gain;
        hadamatrix[10][11] = 1.f * gain;
        hadamatrix[10][12] = 1.f * gain;
        hadamatrix[10][13] = -1.f * gain;
        hadamatrix[10][14] = 1.f * gain;
        hadamatrix[10][15] = 1.f * gain;
        hadamatrix[10][16] = 1.f * gain;
        hadamatrix[10][17] = -1.f * gain;
        hadamatrix[10][18] = -1.f * gain;
        hadamatrix[10][19] = -1.f * gain;
        hadamatrix[10][20] = 1.f * gain;
        hadamatrix[10][21] = -1.f * gain;
        hadamatrix[10][22] = -1.f * gain;
        hadamatrix[10][23] = 1.f * gain;
        hadamatrix[11][0] = 1.f * gain;
        hadamatrix[11][1] = 1.f * gain;
        hadamatrix[11][2] = -1.f * gain;
        hadamatrix[11][3] = 1.f * gain;
        hadamatrix[11][4] = 1.f * gain;
        hadamatrix[11][5] = 1.f * gain;
        hadamatrix[11][6] = -1.f * gain;
        hadamatrix[11][7] = -1.f * gain;
        hadamatrix[11][8] = -1.f * gain;
        hadamatrix[11][9] = 1.f * gain;
        hadamatrix[11][10] = -1.f * gain;
        hadamatrix[11][11] = -1.f * gain;
        hadamatrix[11][12] = 1.f * gain;
        hadamatrix[11][13] = 1.f * gain;
        hadamatrix[11][14] = -1.f * gain;
        hadamatrix[11][15] = 1.f * gain;
        hadamatrix[11][16] = 1.f * gain;
        hadamatrix[11][17] = 1.f * gain;
        hadamatrix[11][18] = -1.f * gain;
        hadamatrix[11][19] = -1.f * gain;
        hadamatrix[11][20] = -1.f * gain;
        hadamatrix[11][21] = 1.f * gain;
        hadamatrix[11][22] = -1.f * gain;
        hadamatrix[11][23] = -1.f * gain;
        hadamatrix[12][0] = 1.f * gain;
        hadamatrix[12][1] = 1.f * gain;
        hadamatrix[12][2] = 1.f * gain;
        hadamatrix[12][3] = 1.f * gain;
        hadamatrix[12][4] = 1.f * gain;
        hadamatrix[12][5] = 1.f * gain;
        hadamatrix[12][6] = 1.f * gain;
        hadamatrix[12][7] = 1.f * gain;
        hadamatrix[12][8] = 1.f * gain;
        hadamatrix[12][9] = 1.f * gain;
        hadamatrix[12][10] = 1.f * gain;
        hadamatrix[12][11] = 1.f * gain;
        hadamatrix[12][12] = -1.f * gain;
        hadamatrix[12][13] = -1.f * gain;
        hadamatrix[12][14] = -1.f * gain;
        hadamatrix[12][15] = -1.f * gain;
        hadamatrix[12][16] = -1.f * gain;
        hadamatrix[12][17] = -1.f * gain;
        hadamatrix[12][18] = -1.f * gain;
        hadamatrix[12][19] = -1.f * gain;
        hadamatrix[12][20] = -1.f * gain;
        hadamatrix[12][21] = -1.f * gain;
        hadamatrix[12][22] = -1.f * gain;
        hadamatrix[12][23] = -1.f * gain;
        hadamatrix[13][0] = 1.f * gain;
        hadamatrix[13][1] = -1.f * gain;
        hadamatrix[13][2] = 1.f * gain;
        hadamatrix[13][3] = -1.f * gain;
        hadamatrix[13][4] = 1.f * gain;
        hadamatrix[13][5] = 1.f * gain;
        hadamatrix[13][6] = 1.f * gain;
        hadamatrix[13][7] = -1.f * gain;
        hadamatrix[13][8] = -1.f * gain;
        hadamatrix[13][9] = -1.f * gain;
        hadamatrix[13][10] = 1.f * gain;
        hadamatrix[13][11] = -1.f * gain;
        hadamatrix[13][12] = -1.f * gain;
        hadamatrix[13][13] = 1.f * gain;
        hadamatrix[13][14] = -1.f * gain;
        hadamatrix[13][15] = 1.f * gain;
        hadamatrix[13][16] = -1.f * gain;
        hadamatrix[13][17] = -1.f * gain;
        hadamatrix[13][18] = -1.f * gain;
        hadamatrix[13][19] = 1.f * gain;
        hadamatrix[13][20] = 1.f * gain;
        hadamatrix[13][21] = 1.f * gain;
        hadamatrix[13][22] = -1.f * gain;
        hadamatrix[13][23] = 1.f * gain;
        hadamatrix[14][0] = 1.f * gain;
        hadamatrix[14][1] = -1.f * gain;
        hadamatrix[14][2] = -1.f * gain;
        hadamatrix[14][3] = 1.f * gain;
        hadamatrix[14][4] = -1.f * gain;
        hadamatrix[14][5] = 1.f * gain;
        hadamatrix[14][6] = 1.f * gain;
        hadamatrix[14][7] = 1.f * gain;
        hadamatrix[14][8] = -1.f * gain;
        hadamatrix[14][9] = -1.f * gain;
        hadamatrix[14][10] = -1.f * gain;
        hadamatrix[14][11] = 1.f * gain;
        hadamatrix[14][12] = -1.f * gain;
        hadamatrix[14][13] = 1.f * gain;
        hadamatrix[14][14] = 1.f * gain;
        hadamatrix[14][15] = -1.f * gain;
        hadamatrix[14][16] = 1.f * gain;
        hadamatrix[14][17] = -1.f * gain;
        hadamatrix[14][18] = -1.f * gain;
        hadamatrix[14][19] = -1.f * gain;
        hadamatrix[14][20] = 1.f * gain;
        hadamatrix[14][21] = 1.f * gain;
        hadamatrix[14][22] = 1.f * gain;
        hadamatrix[14][23] = -1.f * gain;
        hadamatrix[15][0] = 1.f * gain;
        hadamatrix[15][1] = 1.f * gain;
        hadamatrix[15][2] = -1.f * gain;
        hadamatrix[15][3] = -1.f * gain;
        hadamatrix[15][4] = 1.f * gain;
        hadamatrix[15][5] = -1.f * gain;
        hadamatrix[15][6] = 1.f * gain;
        hadamatrix[15][7] = 1.f * gain;
        hadamatrix[15][8] = 1.f * gain;
        hadamatrix[15][9] = -1.f * gain;
        hadamatrix[15][10] = -1.f * gain;
        hadamatrix[15][11] = -1.f * gain;
        hadamatrix[15][12] = -1.f * gain;
        hadamatrix[15][13] = -1.f * gain;
        hadamatrix[15][14] = 1.f * gain;
        hadamatrix[15][15] = 1.f * gain;
        hadamatrix[15][16] = -1.f * gain;
        hadamatrix[15][17] = 1.f * gain;
        hadamatrix[15][18] = -1.f * gain;
        hadamatrix[15][19] = -1.f * gain;
        hadamatrix[15][20] = -1.f * gain;
        hadamatrix[15][21] = 1.f * gain;
        hadamatrix[15][22] = 1.f * gain;
        hadamatrix[15][23] = 1.f * gain;
        hadamatrix[16][0] = 1.f * gain;
        hadamatrix[16][1] = -1.f * gain;
        hadamatrix[16][2] = 1.f * gain;
        hadamatrix[16][3] = -1.f * gain;
        hadamatrix[16][4] = -1.f * gain;
        hadamatrix[16][5] = 1.f * gain;
        hadamatrix[16][6] = -1.f * gain;
        hadamatrix[16][7] = 1.f * gain;
        hadamatrix[16][8] = 1.f * gain;
        hadamatrix[16][9] = 1.f * gain;
        hadamatrix[16][10] = -1.f * gain;
        hadamatrix[16][11] = -1.f * gain;
        hadamatrix[16][12] = -1.f * gain;
        hadamatrix[16][13] = 1.f * gain;
        hadamatrix[16][14] = -1.f * gain;
        hadamatrix[16][15] = 1.f * gain;
        hadamatrix[16][16] = 1.f * gain;
        hadamatrix[16][17] = -1.f * gain;
        hadamatrix[16][18] = 1.f * gain;
        hadamatrix[16][19] = -1.f * gain;
        hadamatrix[16][20] = -1.f * gain;
        hadamatrix[16][21] = -1.f * gain;
        hadamatrix[16][22] = 1.f * gain;
        hadamatrix[16][23] = 1.f * gain;
        hadamatrix[17][0] = 1.f * gain;
        hadamatrix[17][1] = -1.f * gain;
        hadamatrix[17][2] = -1.f * gain;
        hadamatrix[17][3] = 1.f * gain;
        hadamatrix[17][4] = -1.f * gain;
        hadamatrix[17][5] = -1.f * gain;
        hadamatrix[17][6] = 1.f * gain;
        hadamatrix[17][7] = -1.f * gain;
        hadamatrix[17][8] = 1.f * gain;
        hadamatrix[17][9] = 1.f * gain;
        hadamatrix[17][10] = 1.f * gain;
        hadamatrix[17][11] = -1.f * gain;
        hadamatrix[17][12] = -1.f * gain;
        hadamatrix[17][13] = 1.f * gain;
        hadamatrix[17][14] = 1.f * gain;
        hadamatrix[17][15] = -1.f * gain;
        hadamatrix[17][16] = 1.f * gain;
        hadamatrix[17][17] = 1.f * gain;
        hadamatrix[17][18] = -1.f * gain;
        hadamatrix[17][19] = 1.f * gain;
        hadamatrix[17][20] = -1.f * gain;
        hadamatrix[17][21] = -1.f * gain;
        hadamatrix[17][22] = -1.f * gain;
        hadamatrix[17][23] = 1.f * gain;
        hadamatrix[18][0] = 1.f * gain;
        hadamatrix[18][1] = -1.f * gain;
        hadamatrix[18][2] = -1.f * gain;
        hadamatrix[18][3] = -1.f * gain;
        hadamatrix[18][4] = 1.f * gain;
        hadamatrix[18][5] = -1.f * gain;
        hadamatrix[18][6] = -1.f * gain;
        hadamatrix[18][7] = 1.f * gain;
        hadamatrix[18][8] = -1.f * gain;
        hadamatrix[18][9] = 1.f * gain;
        hadamatrix[18][10] = 1.f * gain;
        hadamatrix[18][11] = 1.f * gain;
        hadamatrix[18][12] = -1.f * gain;
        hadamatrix[18][13] = 1.f * gain;
        hadamatrix[18][14] = 1.f * gain;
        hadamatrix[18][15] = 1.f * gain;
        hadamatrix[18][16] = -1.f * gain;
        hadamatrix[18][17] = 1.f * gain;
        hadamatrix[18][18] = 1.f * gain;
        hadamatrix[18][19] = -1.f * gain;
        hadamatrix[18][20] = 1.f * gain;
        hadamatrix[18][21] = -1.f * gain;
        hadamatrix[18][22] = -1.f * gain;
        hadamatrix[18][23] = -1.f * gain;
        hadamatrix[19][0] = 1.f * gain;
        hadamatrix[19][1] = 1.f * gain;
        hadamatrix[19][2] = -1.f * gain;
        hadamatrix[19][3] = -1.f * gain;
        hadamatrix[19][4] = -1.f * gain;
        hadamatrix[19][5] = 1.f * gain;
        hadamatrix[19][6] = -1.f * gain;
        hadamatrix[19][7] = -1.f * gain;
        hadamatrix[19][8] = 1.f * gain;
        hadamatrix[19][9] = -1.f * gain;
        hadamatrix[19][10] = 1.f * gain;
        hadamatrix[19][11] = 1.f * gain;
        hadamatrix[19][12] = -1.f * gain;
        hadamatrix[19][13] = -1.f * gain;
        hadamatrix[19][14] = 1.f * gain;
        hadamatrix[19][15] = 1.f * gain;
        hadamatrix[19][16] = 1.f * gain;
        hadamatrix[19][17] = -1.f * gain;
        hadamatrix[19][18] = 1.f * gain;
        hadamatrix[19][19] = 1.f * gain;
        hadamatrix[19][20] = -1.f * gain;
        hadamatrix[19][21] = 1.f * gain;
        hadamatrix[19][22] = -1.f * gain;
        hadamatrix[19][23] = -1.f * gain;
        hadamatrix[20][0] = 1.f * gain;
        hadamatrix[20][1] = 1.f * gain;
        hadamatrix[20][2] = 1.f * gain;
        hadamatrix[20][3] = -1.f * gain;
        hadamatrix[20][4] = -1.f * gain;
        hadamatrix[20][5] = -1.f * gain;
        hadamatrix[20][6] = 1.f * gain;
        hadamatrix[20][7] = -1.f * gain;
        hadamatrix[20][8] = -1.f * gain;
        hadamatrix[20][9] = 1.f * gain;
        hadamatrix[20][10] = -1.f * gain;
        hadamatrix[20][11] = 1.f * gain;
        hadamatrix[20][12] = -1.f * gain;
        hadamatrix[20][13] = -1.f * gain;
        hadamatrix[20][14] = -1.f * gain;
        hadamatrix[20][15] = 1.f * gain;
        hadamatrix[20][16] = 1.f * gain;
        hadamatrix[20][17] = 1.f * gain;
        hadamatrix[20][18] = -1.f * gain;
        hadamatrix[20][19] = 1.f * gain;
        hadamatrix[20][20] = 1.f * gain;
        hadamatrix[20][21] = -1.f * gain;
        hadamatrix[20][22] = 1.f * gain;
        hadamatrix[20][23] = -1.f * gain;
        hadamatrix[21][0] = 1.f * gain;
        hadamatrix[21][1] = 1.f * gain;
        hadamatrix[21][2] = 1.f * gain;
        hadamatrix[21][3] = 1.f * gain;
        hadamatrix[21][4] = -1.f * gain;
        hadamatrix[21][5] = -1.f * gain;
        hadamatrix[21][6] = -1.f * gain;
        hadamatrix[21][7] = 1.f * gain;
        hadamatrix[21][8] = -1.f * gain;
        hadamatrix[21][9] = -1.f * gain;
        hadamatrix[21][10] = 1.f * gain;
        hadamatrix[21][11] = -1.f * gain;
        hadamatrix[21][12] = -1.f * gain;
        hadamatrix[21][13] = -1.f * gain;
        hadamatrix[21][14] = -1.f * gain;
        hadamatrix[21][15] = -1.f * gain;
        hadamatrix[21][16] = 1.f * gain;
        hadamatrix[21][17] = 1.f * gain;
        hadamatrix[21][18] = 1.f * gain;
        hadamatrix[21][19] = -1.f * gain;
        hadamatrix[21][20] = 1.f * gain;
        hadamatrix[21][21] = 1.f * gain;
        hadamatrix[21][22] = -1.f * gain;
        hadamatrix[21][23] = 1.f * gain;
        hadamatrix[22][0] = 1.f * gain;
        hadamatrix[22][1] = -1.f * gain;
        hadamatrix[22][2] = 1.f * gain;
        hadamatrix[22][3] = 1.f * gain;
        hadamatrix[22][4] = 1.f * gain;
        hadamatrix[22][5] = -1.f * gain;
        hadamatrix[22][6] = -1.f * gain;
        hadamatrix[22][7] = -1.f * gain;
        hadamatrix[22][8] = 1.f * gain;
        hadamatrix[22][9] = -1.f * gain;
        hadamatrix[22][10] = -1.f * gain;
        hadamatrix[22][11] = 1.f * gain;
        hadamatrix[22][12] = -1.f * gain;
        hadamatrix[22][13] = 1.f * gain;
        hadamatrix[22][14] = -1.f * gain;
        hadamatrix[22][15] = -1.f * gain;
        hadamatrix[22][16] = -1.f * gain;
        hadamatrix[22][17] = 1.f * gain;
        hadamatrix[22][18] = 1.f * gain;
        hadamatrix[22][19] = 1.f * gain;
        hadamatrix[22][20] = -1.f * gain;
        hadamatrix[22][21] = 1.f * gain;
        hadamatrix[22][22] = 1.f * gain;
        hadamatrix[22][23] = -1.f * gain;
        hadamatrix[23][0] = 1.f * gain;
        hadamatrix[23][1] = 1.f * gain;
        hadamatrix[23][2] = -1.f * gain;
        hadamatrix[23][3] = 1.f * gain;
        hadamatrix[23][4] = 1.f * gain;
        hadamatrix[23][5] = 1.f * gain;
        hadamatrix[23][6] = -1.f * gain;
        hadamatrix[23][7] = -1.f * gain;
        hadamatrix[23][8] = -1.f * gain;
        hadamatrix[23][9] = 1.f * gain;
        hadamatrix[23][10] = -1.f * gain;
        hadamatrix[23][11] = -1.f * gain;
        hadamatrix[23][12] = -1.f * gain;
        hadamatrix[23][13] = -1.f * gain;
        hadamatrix[23][14] = 1.f * gain;
        hadamatrix[23][15] = -1.f * gain;
        hadamatrix[23][16] = -1.f * gain;
        hadamatrix[23][17] = -1.f * gain;
        hadamatrix[23][18] = 1.f * gain;
        hadamatrix[23][19] = 1.f * gain;
        hadamatrix[23][20] = 1.f * gain;
        hadamatrix[23][21] = -1.f * gain;
        hadamatrix[23][22] = 1.f * gain;
        hadamatrix[23][23] = 1.f * gain;
    }
    
    else if ( !is_pow2(order) ) {
        std::cout << "Order must be power of 2 or 24" << std::endl;
        hadamatrix.resize(0);
    }
    
    else if (order != 2)
    {
        int current_order = 2;
        int next_pow2 = ceil(log2(order));
        
        for (int i = 0; i < next_pow2-1; i++) {
            current_order *= 2;
            
            for (int row = 0; row < current_order/2; row++) {
                for (int col = 0; col < current_order/2; col++) {
                    hadamatrix[row][col+current_order/2] = hadamatrix[row][col];
                    hadamatrix[row+current_order/2][col] = hadamatrix[col][row];
                    
                    hadamatrix[row+current_order/2][col+current_order/2] =
                    -hadamatrix[row][col];                    
                }
            }
        }
    }
    hadamatrix.resize(order);
    
    return hadamatrix;
};

bool SSRverb::is_pow2(unsigned x)
{
    return !(x == 0) && !(x & (x-1));
};
